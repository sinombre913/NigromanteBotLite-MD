import _0x3e261e from'mongoose';const {Schema,connect,model:_model}=_0x3e261e,defaultOptions={'useNewUrlParser':!![],'useUnifiedTopology':!![]};export class mongoDB{constructor(_0xb1503,_0x16c045=defaultOptions){this['url']=_0xb1503,this['options']=_0x16c045,this['data']=this['_data']={},this['_schema']={},this['_model']={},this['db']=connect(this['url'],{...this['options']})['catch'](console['error']);}async['read'](){this['conn']=await this['db'];const _0x494b86=this['_schema']=new Schema({'data':{'type':Object,'required':!![],'default':{}}});try{this['_model']=_model('data',_0x494b86);}catch{this['_model']=_model('data');}this['_data']=await this['_model']['findOne']({});if(!this['_data']){this['data']={};const [_0x4d80f8,_0x1b8bb5]=await Promise['all']([this['write'](this['data']),this['_model']['findOne']({})]);this['_data']=_0x1b8bb5;}else this['data']=this['_data']['data'];return this['data'];}['write'](_0x58250d){return new Promise(async(_0x340c9e,_0x3c02c4)=>{if(!_0x58250d)return _0x3c02c4(_0x58250d);if(!this['_data'])return _0x340c9e(new this['_model']({'data':_0x58250d})['save']());this['_model']['findById'](this['_data']['_id'],(_0x20d493,_0x150427)=>{if(_0x20d493)return _0x3c02c4(_0x20d493);if(!_0x150427['data'])_0x150427['data']={};return _0x150427['data']=_0x58250d,this['data']={},_0x150427['save'](_0x340c9e);});});}}export const mongoDBV2=class MongoDBV2{constructor(_0x1f9001,_0x9408b0=defaultOptions){this['url']=_0x1f9001,this['options']=_0x9408b0,this['models']=[],this['data']={},this['lists'],this['list'],this['db']=connect(this['url'],{...this['options']})['catch'](console['error']);}async['read'](){this['conn']=await this['db'];const _0x166d57=new Schema({'data':[{'name':String}]});try{this['list']=_model('lists',_0x166d57);}catch(_0x5bd215){this['list']=_model('lists');}this['lists']=await this['list']['findOne']({});!lists?.['data']&&(await this['list']['create']({'data':[]}),this['lists']=await this['list']['findOne']({}));const _0x451216=[];for(const {name:_0x599741}of this['lists']['data']){let _0x18f143;try{_0x18f143=_model(_0x599741,new Schema({'data':Array}));}catch(_0x167f60){console['error'](_0x167f60);try{_0x18f143=_model(_0x599741);}catch(_0x4fa253){_0x451216['push'](_0x599741),console['error'](_0x4fa253);}}if(_0x18f143){this['models']['push']({'name':_0x599741,'model':_0x18f143});const _0x48ce7b=await _0x18f143['find']({});this['data'][_0x599741]=Object['fromEntries'](_0x48ce7b['map'](_0x1e1881=>_0x1e1881['data']));}}try{const _0x332493=await this['list']['findById'](this['lists']['_id']);_0x332493['data']=_0x332493['data']['filter'](_0x240942=>!_0x451216['includes'](_0x240942['name'])),await _0x332493['save']();}catch(_0x5dcf14){console['error'](_0x5dcf14);}return this['data'];}['write'](_0x5e181f){return new Promise(async(_0x329ab0,_0x43a133)=>{if(!this['lists']||!_0x5e181f)return _0x43a133(_0x5e181f||this['lists']);const _0x2ed1b0=Object['keys'](_0x5e181f),_0x5ac159=[];let _0x4c7e93=0x0;for(const _0x10643c of _0x2ed1b0){if((_0x4c7e93=this['models']['findIndex'](_0x1d7453=>_0x1d7453['name']===_0x10643c))!==-0x1){const _0x110697=this['models'][_0x4c7e93]['model'];await _0x110697['deleteMany']()['catch'](console['error']),await _0x110697['insertMany'](Object['entries'](_0x5e181f[_0x10643c])['map'](_0x5b4a0f=>({'data':_0x5b4a0f})));if(_0x110697&&_0x10643c)_0x5ac159['push']({'name':_0x10643c});}else{const _0x347ce5=new Schema({'data':Array});let _0xae9abf;try{_0xae9abf=_model(_0x10643c,_0x347ce5);}catch(_0x59b92d){console['error'](_0x59b92d),_0xae9abf=_model(_0x10643c);}_0x4c7e93=this['models']['findIndex'](_0x6ae928=>_0x6ae928['name']===_0x10643c),this['models'][_0x4c7e93===-0x1?this['models']['length']:_0x4c7e93]={'name':_0x10643c,'model':_0xae9abf},await _0xae9abf['insertMany'](Object['entries'](_0x5e181f[_0x10643c])['map'](_0x3770ba=>({'data':_0x3770ba})));if(_0xae9abf&&_0x10643c)_0x5ac159['push']({'name':_0x10643c});}}return this['list']['findById'](this['lists']['_id'],function(_0x40804c,_0x442e3f){if(_0x40804c)return _0x43a133(_0x40804c);return _0x442e3f['data']=_0x5ac159,this['data']={},_0x442e3f['save'](_0x329ab0);}),_0x329ab0(!![]);});}};